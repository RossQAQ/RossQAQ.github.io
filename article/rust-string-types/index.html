<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Rust 的各种字符串类型确实让初学者十分迷惑"><title>理解 Rust 的各种字符串类型</title>
<link rel=canonical href=https://rossqaq.github.io/article/rust-string-types/><link rel=stylesheet href=/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="理解 Rust 的各种字符串类型"><meta property='og:description' content="Rust 的各种字符串类型确实让初学者十分迷惑"><meta property='og:url' content='https://rossqaq.github.io/article/rust-string-types/'><meta property='og:site_name' content='Roses'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-07-04T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-04T00:00:00+00:00'><meta name=twitter:title content="理解 Rust 的各种字符串类型"><meta name=twitter:description content="Rust 的各种字符串类型确实让初学者十分迷惑"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu57fe4ea25b3b752b8c24bca0d657f08c_427356_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>♉</span></figure><div class=site-meta><h1 class=site-name><a href=/>Roses</a></h1><h2 class=site-description>有限的时间，无尽的痛苦。</h2></div></header><ol class=menu-social><li><a href=https://space.bilibili.com/3078464 target=_blank title=Bilibili rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-bilibili" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"/><path d="M8 3l2 3"/><path d="M16 3l-2 3"/><path d="M9 13v-2"/><path d="M15 11v2"/></svg></a></li><li><a href=https://github.com/RossQAQ target=_blank title=Github rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href='https://music.163.com/playlist?id=109571638&amp;userid=93740300' target=_blank title=网易云音乐 rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-netease-music" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 4c-2.93 1.346-5 5.046-5 8.492C4 17 8 20 12 20s8-3 8-7c0-3.513-3.5-5.513-6-5.513S9 9 9 12c0 2 1.5 3 3 3s3-1 3-3c0-3.513-2-4.508-2-6.515.0-3.504 3.5-2.603 4-1.502"/></svg></a></li><li><a href=mailto:rossqaq@outlook.com target=_blank title=邮件 rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友情链接</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#理解-rust-字符串类型们>理解 Rust 字符串类型们</a><ol><li><a href=#什么是-string>什么是 <code>String</code></a></li><li><a href=#什么是-string-1>什么是 <code>&amp;String</code></a></li><li><a href=#什么是-str>什么是 <code>&amp;str</code></a></li></ol></li><li><a href=#实践中-str-的含义>实践中 <code>&amp;str</code> 的含义</a><ol><li><a href=#嵌套循环的示例>嵌套循环的示例</a></li><li><a href=#api-设计>API 设计</a></li><li><a href=#拥有所有权的字符串>拥有所有权的字符串</a><ol><li><a href=#string-和-str-用法的例子><code>String</code> 和 <code>&amp;str</code> 用法的例子</a></li></ol></li></ol></li><li><a href=#只读参数切片>只读参数/切片</a></li><li><a href=#在结构体中使用-rust-的字符串类型>在结构体中使用 Rust 的字符串类型</a></li><li><a href=#rust-的字符串操作>Rust 的字符串操作</a><ol><li><a href=#rust-的字符串切片>Rust 的字符串切片</a></li><li><a href=#使用-contains-来进行模式匹配>使用 <code>contains</code> 来进行模式匹配</a></li><li><a href=#使用-starts_with-来进行模式匹配>使用 <code>starts_with</code> 来进行模式匹配</a></li><li><a href=#使用-find-来进行模式匹配>使用 <code>find</code> 来进行模式匹配</a></li><li><a href=#使用-rfind-来进行模式匹配>使用 <code>rfind</code> 来进行模式匹配</a></li></ol></li><li><a href=#rust-中的字符串转换>Rust 中的字符串转换</a><ol><li><a href=#rust-中转换为字符串>Rust 中转换为字符串</a></li><li><a href=#解析字符串>解析字符串</a></li></ol></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/rust/ style=background-color:#2a9d8f;color:#fff>Rust
</a><a href=/categories/finished/ style=background-color:#2a9d8f;color:#fff>施工完毕</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/article/rust-string-types/>理解 Rust 的各种字符串类型</a></h2><h3 class=article-subtitle>Rust 的各种字符串类型确实让初学者十分迷惑</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 04, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 9 分钟</time></div></footer></div></header><section class=article-content><p>本文是文章 Understanding String and &amp;str in Rust 的阅读翻译，<a class=link href=https://blog.logrocket.com/understanding-rust-string-str target=_blank rel=noopener>查看原文</a>。</p><p>根据你的编程背景，Rust 的各种字符串类型可能会迷惑你，比如 <code>String</code>, <code>str</code>。这篇文章中，我们会澄清 <code>String</code> 和 <code>str</code> 的区别，更细致的说就是 <code>String</code>, <code>&amp;String</code>, 以及 <code>&amp;str</code>，尤其是决定好什么时候该用什么。</p><p>理解了这篇文章中的内容有助于你更高效的使用 Rust 的字符串，也有助于你更好的理解他人的代码，看看别人是怎么处理字符串的。</p><p>首先，我们需要从理论层面上来看，例如不同字符串类型的结构，以及他们在内存位置、可变性的不同之处。之后，我们会看一下实践中他们的区别，讨论如何正确使用这些类型。最后，我们会简单举例说明。</p><p>如果你是 Rust 刚刚起步，那么这篇文章应该会很好的帮助你。它会解释为什么有的时候你的关于字符串的代码无法编译。</p><h2 id=理解-rust-字符串类型们>理解 Rust 字符串类型们</h2><p>这一部分中，我们会解释在语言层面这些类型的区别以及他们的 implications。泛泛地说，就是他们在所有权和内存层面的区别。</p><p><strong>Rust 的所有的字符串类型总是保证为有效的 UTF-8.</strong></p><h3 id=什么是-string>什么是 <code>String</code></h3><p><code>String</code> 是所有权类型，需要被分配。它具有动态大小，因而编译器无法知道它的大小，但它内部的数组的容量可以随时改变，这个类型自己基本是以下形式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nb>String</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>vec</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>因为它包含了一个 <code>Vec</code>，我们知道它有一个指向一个区块的指针，一个 size 以及一个 capcity。size 是字符串的有效长度，capcity 告诉我们字符串的长度最大在多少时需要重新分配内存。指针指向一个连续的字符数组，<code>capcity</code> <code>size</code> 都在它内部了。</p><p><strong><code>String</code>s 非常的灵活，我们总是可以创建一个新的，动态的可修改的字符串。但这也一些开销，我们总是需要分配内存。</strong></p><hr><h3 id=什么是-string-1>什么是 <code>&amp;String</code></h3><p><code>&amp;String</code> 类型是 <code>String</code> 的引用。这意味着它不是一个拥有所有权的类型，它的大小在编译期是可知的，因为它只是一个指向 <code>String</code> 的指针。</p><p>关于 <code>&amp;String</code> 没有太多可以说的内容。但因为它没有所有权，我们可以到处传递 <code>&amp;String</code>，只要我们引用的内容没有出作用域，我们并不需要担心内存分配。</p><p>大多数情况下，<code>String</code> 和 <code>&amp;String</code> 的区别基本是在<a class=link href=https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html target=_blank rel=noopener>借用</a>上。</p><p>有意思的一件事是，<code>&amp;String</code> 可以在编译期被 Rust deref 为 <code>&amp;str</code>。这在 API 的灵活性上很有用。但反之是不行的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>coerce_success</span><span class=p>(</span><span class=n>data</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>coerce_fail</span><span class=p>(</span><span class=n>data</span>: <span class=kp>&amp;</span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello_world&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>mutable_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Hello&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>coerce_success</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutable_string</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>coerce_fail</span><span class=p>(</span><span class=n>s</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h3 id=什么是-str>什么是 <code>&amp;str</code></h3><p>最终，我们看看 <code>&amp;str</code>，因为 <code>&amp;str</code> 由指向内存的指针组成（包括一个 size），它的 size 在编译期是已知的。</p><p>内存可以是 heap，stack，或者是二进制可执行文件的 static 内存。**它也不是一个所有权类型，而是一个对字符串切片的只读引用。**Rust 保证当 <code>&amp;str</code> 在作用域内时，底层的内存不会改变，即使跨线程。</p><p>就像上文说的，<code>&amp;String</code> 可以转换为 <code>&amp;str</code>，<strong>这意味着 <code>&amp;str</code> 作为函数的参数很好用（如果不需要所有权和可变形的话）。</strong></p><p><code>&amp;str</code> 在需要一个字符串切片（视图）时很好用。然而，<strong>记住 <code>&amp;str</code> 只是一个指向 <code>str</code> 的指针，而 <code>str</code> 的大小在编译期不可知，而它天然时不可变的，所以 capcity 也不可变。</strong></p><p>很重要的是，像上文提到过的，<strong><code>&amp;str</code> 指向的内存中 <code>&amp;str</code> 存活期间是不可变的，即使是 <code>str</code> 的所有者也不行。</strong></p><h2 id=实践中-str-的含义>实践中 <code>&amp;str</code> 的含义</h2><p>理解了上面的概念那么你就可以让代码过编译了。</p><p>此外，还有一些 API 的语义表达，以及一些性能方面的考虑。</p><p>在性能方面，你需要考虑知道创建一个 <code>String</code> 总是需要内存分配。如果你可以避免额外的分配，那你就应该这么做，因为他们需要一些时间以及对你的运行时造成一些负担。</p><h3 id=嵌套循环的示例>嵌套循环的示例</h3><p>考虑一个情况，在一个嵌套的循环中，你总是需要某一个字符串的不同部分。如果你每次创建一个 <code>String</code>，那么你每次都要为子串分配内存，以及还要做一大堆其他事情。而实际上你仅仅需要 <code>&amp;str</code> 的字符串切片。</p><p>同样的事情在传递数据时也会发生，如果你到处传递拥有所有权的 <code>String</code> 实例而不是可变借用（<code>&amp;mut String</code>）或者是他们的只读视图，那么就会发生很多本可以避免的内存分配。</p><p>所以为了性能，知道什么时候发生内存分配以及你什么时候不需要分配是很重要的，因为你可以重用字符串的切片。</p><hr><h3 id=api-设计>API 设计</h3><p>谈到 API 的设计，那么事情就有一些复杂了，你需要在心中明确的了解你的 API 目标，并且为你的用户选择一个正确的类型来达成这个目标。</p><p>例如，<strong>因为 <code>&amp;String</code> 可以转换为 <code>&amp;str</code>，但不能反过来</strong>，所以如果只需要一个只读的字符串视图，那么在参数中使用 <code>&amp;str</code> 一般是正确的。</p><p>此外，如果一个函数需要修改给定的 <code>String</code>，就完全不能传递 <code>&amp;str</code> 了，因为它是不可变的，你需要创建一个新的 <code>String</code> 之后它会返回。如果你需要修改，那么使用 <code>&amp;mut String</code></p><hr><h3 id=拥有所有权的字符串>拥有所有权的字符串</h3><p>在你需要具有所有权类型的字符串时需要思考这些事，例如你需要把字符串传给一个线程，或者需要创建一个成员中具有所有权字符串的结构体时。这些情况下，你需要直接使用 <code>String</code>，因为 <code>&amp;String</code> 和 <code>&amp;str</code> 都是借用的类型。</p><p>在某些情况下，所有权和可变性都很重要，在 <code>String</code> 和 <code>&amp;str</code> 之间的选择很重要。在大部分情况下，你用了不正确的类型都会无法编译，如果你对这些类型的属性以及它们之间的转换没有正确的理解的话，你可能会写出迷惑的 API。</p><p>我们看看例子。</p><h4 id=string-和-str-用法的例子><code>String</code> 和 <code>&amp;str</code> 用法的例子</h4><p>以下的示例展示了上面提到的一些情况，以及包含一些解决的方法。</p><p>记住，这些都是独立的、人为设置的例子，在实际中还要考虑其他的因素，然而，你可以把这个当作基本的宗旨。</p><ol><li><p>常量字符串</p><p><strong>这是最简单的例子，如果你需要一个字符串常量，那么推荐采用以下的方式</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>const</span><span class=w> </span><span class=no>CONST_STRING</span>: <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span> <span class=o>=</span><span class=w> </span><span class=s>&#34;some constant string&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>CONST_STRING</code> 是只读且满足静态生命周期的字符串，在执行中被直接装入内存。</p></li><li><p>字符串可变性</p><p><strong>如果你有一个 <code>String</code>，你想在函数中修改它，那么你可以使用 <code>&amp;mut String</code> 作为参数</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>mutable_str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>do_some_mutation</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>mutable_string</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>mutable_string</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>do_some_mutation</span><span class=p>(</span><span class=n>input</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>input</span><span class=p>.</span><span class=n>push_str</span><span class=p>(</span><span class=s>&#34;add this to the end&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>但要注意的是如果长度超过 capcity，那么也会重新分配内存。</p></li><li><p>具有所有权的字符串</p><p>当你想从函数中返回字符串，或者你想把所有权也一并传递给其他线程等</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Hello World&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>do_something</span><span class=p>(</span><span class=n>s</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>do_something</span><span class=p>(</span><span class=n>intput</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>String</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>input</span><span class=p>.</span><span class=n>to_ascii_uppercase</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Owned</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>bla</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>create_owned</span><span class=p>(</span><span class=n>other_bla</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Owned</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Owned</span><span class=w> </span><span class=p>{</span><span class=n>bla</span>: <span class=nc>other_bla</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=只读参数切片>只读参数/切片</h2><p>如果不需要修改字符串，用 <code>&amp;str</code> 作为参数类型即可，<code>String</code> 也可以用，因为 <code>&amp;String</code> 可以被 deref 为 <code>&amp;str</code>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>const</span><span class=w> </span><span class=no>CONST_STRING</span>: <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span> <span class=o>=</span><span class=w> </span><span class=s>&#34;some constant string&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello_world&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>mutable_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>print_something</span><span class=p>(</span><span class=o>&amp;</span><span class=n>mutable_string</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>print_something</span><span class=p>(</span><span class=n>s</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>print_something</span><span class=p>(</span><span class=no>CONST_STRING</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>print_something</span><span class=p>(</span><span class=n>something</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>something</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如你所见，我们可以使用 <code>&amp;String</code>, <code>&'static str</code>，以及 <code>&amp;str</code> 作为输入的参数。</p><h2 id=在结构体中使用-rust-的字符串类型>在结构体中使用 Rust 的字符串类型</h2><p>结构体中我们可以使用 <code>String</code> 和 <code>&amp;str</code>，主要的问题是看你的结构体是否需要拥有某个字符串的所有权。如果你使用 <code>&amp;str</code>，那么你需要使用 Rust 的生命周期标注，<strong>保证结构体对象存活时间不长于它借用的字符串，否则就会无法编译。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Owned</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>bla</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Borrowed</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>bla</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>create_something</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Borrowed</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Owned</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>bla</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;bla&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Borrowed</span><span class=w> </span><span class=p>{</span><span class=n>bla</span>: <span class=kp>&amp;</span><span class=nc>o</span><span class=p>.</span><span class=n>bla</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这个代码无法通过编译，因为 <code>Borrowed</code> 中的值存活的时间比 <code>O</code> 更长。</p><p>这样写即可：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Owned</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>bla</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Borrowed</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>bla</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Owned</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>bla</span>: <span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;bla&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>create_something</span><span class=p>(</span><span class=o>&amp;</span><span class=n>o</span><span class=p>.</span><span class=n>bla</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>create_something</span><span class=p>(</span><span class=n>other_bla</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Borrowed</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Borrowed</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>bla</span>: <span class=nc>other_bla</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=rust-的字符串操作>Rust 的字符串操作</h2><p>Rust 提供了很多 built-in 方法来操作字符串，我们会在这一部分中探索一下。</p><blockquote><p>Roses：终于到重点了，想必上面的内容对 C++ 程序员来说不成问题。</p></blockquote><h3 id=rust-的字符串切片>Rust 的字符串切片</h3><p>可以使用字符串切片来引用字符串的子集。使用两个中括号+数字的形式来切片，自然也是左闭右开。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>hello_world</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>ello</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>hello_world</span><span class=p>[</span><span class=mi>1</span><span class=o>..</span><span class=mi>5</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>orld</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>hello_world</span><span class=p>[</span><span class=mi>7</span><span class=o>..</span><span class=mi>11</span><span class=p>];</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>省略左侧数字可以从 <code>0</code> 开始，省略右侧数字可以直接索引到最后一个字符。</p><p>可以这样引用整个 String，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>hello_world_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>hello_world</span><span class=p>[</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如前文所说，Rust 把存储的字符串是 UTF-8 编码的顺序字节，也就是说，<strong>上面的例子只对 单字节 的字符有效。如果你的字符由多个字节组成，你就必须中字符的边缘切片。否则 Rust 就会 panic，因为你中多个字节组成的字符的中间切片来。</strong></p><p>例如，❤️这个emoji，就是6个字节编码而成，6～11 之间的索引都用来表示这个 emoji，也就是说，<code>start_index</code> 和 <code>end_index</code> 在 6～12 之间都会 panic。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>hello_love</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello ❤️&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>heart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>hello_love</span><span class=p>[</span><span class=mi>6</span><span class=o>..</span><span class=mi>12</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>broken_heart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>hello_love</span><span class=p>[</span><span class=mi>6</span><span class=o>..</span><span class=mi>8</span><span class=p>];</span><span class=w> </span><span class=c1>//error
</span></span></span></code></pre></td></tr></table></div></div><hr><h3 id=使用-contains-来进行模式匹配>使用 <code>contains</code> 来进行模式匹配</h3><p><code>contains</code> 方法，就像它的名字表示的一样，是检查一个字符串切片的位置。你可以使用它来检查一个字符串切片是否是另一个字符串的子集。返回值是 bool。</p><p>传递给它的参数必须是 <code>&amp;str</code> ，<code>char</code>，或者 <code>char</code>s 的切片。</p><hr><h3 id=使用-starts_with-来进行模式匹配>使用 <code>starts_with</code> 来进行模式匹配</h3><p>在 Rust 中，你可以使用 <code>start_with</code> 方法来检查一个字符串切片是否以另一个字符串开头。返回值也是 bool。</p><p>注意这个方法大小写敏感。</p><hr><h3 id=使用-find-来进行模式匹配>使用 <code>find</code> 来进行模式匹配</h3><p><code>find</code> 方法会查找模式在字符串切片中第一次出现的位置，返回值是 <code>Option</code>。</p><p>注意这个方法也是大小写敏感。</p><hr><h3 id=使用-rfind-来进行模式匹配>使用 <code>rfind</code> 来进行模式匹配</h3><p><code>rfind</code> 和 <code>find</code> 非常像，它是查找一个字符串最后出现的位置，返回值也是 Option。</p><h2 id=rust-中的字符串转换>Rust 中的字符串转换</h2><h3 id=rust-中转换为字符串>Rust 中转换为字符串</h3><p>你可以使用 <code>to_string</code> 方法将任何实现了 <code>ToString</code> trait 的类型的值转换为字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>my_bool</span>: <span class=kt>bool</span> <span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>my_int</span>: <span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=mi>23</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>my_float</span>: <span class=kt>f32</span> <span class=o>=</span><span class=w> </span><span class=mf>3.14</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>my_char</span>: <span class=kt>char</span> <span class=o>=</span><span class=w> </span><span class=sc>&#39;a&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>my_bool</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>my_int</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>my_float</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>my_char</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>实现了 <code>Display</code> trait 的类型天然实现了 <code>ToString</code>，你就不需要再实现一次了。</strong></p><p><strong>前文提到 Rust 中主要有两种字符串类型。有时你需要把一种转换为另外一种。你可以使用 <code>String::from</code> 把字符串切片转换为 <code>String</code></strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>my_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Hello World&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>相反，可以使用 <code>as_str</code> 方法把 <code>String</code> 转换为字符串切片，<code>as_str</code> 方法借用了底层的数据。</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>my_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;Hello World&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>my_string_slice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>my_string</span><span class=p>.</span><span class=n>as_str</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h3 id=解析字符串>解析字符串</h3><p>你可能会写把字符串类型解析为其他类型，他们需要实现 <code>FromStr</code> trait。<code>parse</code> 方法就可以使用了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>my_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;10&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>parsed_string</span>: <span class=kt>u32</span> <span class=o>=</span><span class=w> </span><span class=n>my_string</span><span class=p>.</span><span class=n>parse</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>因为你要把字符串解析为其他类型，所以你需要显式指明类型，就像例子一样。Rust 文档中提供了 <a class=link href=https://doc.rust-lang.org/std/str/trait.FromStr.html target=_blank rel=noopener>实现 <code>FromStr</code> trait 的 built-in 类型</a>，关于 trait 可以看 <a class=link href=https://blog.logrocket.com/rust-traits-a-deep-dive/ target=_blank rel=noopener>Rust traits: A deep dive</a></p><blockquote><p>之后会尝试翻译。</p></blockquote><p>除了中前面指明类型，你还可以用 Rust 的 &ldquo;turbofish&rdquo; 语法，即：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>my_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;10&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>parsed_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>my_string</span><span class=p>.</span><span class=n>parse</span>::<span class=o>&lt;</span><span class=kt>u32</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果你使用 parse 方法，需要确保字符串提供了有效的字符。你正在解析的字符串可能包含无效字符，<strong>比如 units，尾随的空格，locale 的格式，例如千分隔符。</strong></p><p><strong>你可以使用 built-in 的 <code>trim</code>, <code>trim_start</code>, <code>trim_matches</code>, <code>replace</code> 来移除这些字符，这样你就可以正确解析了</strong>，就像例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=kd>let</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34; 200,000 &#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>price</span><span class=p>.</span><span class=n>trim</span><span class=p>().</span><span class=n>replace</span><span class=p>(</span><span class=s>&#34;,&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>).</span><span class=n>parse</span>::<span class=o>&lt;</span><span class=kt>u32</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>类似的，你解析的字符表示的数字可能会溢出，注意潜在的错误。</p><p><code>parse</code> 返回的是一个错误，如果不能解析成制定类型的话。注意正确的进行错误处理。</p><p>如果有更加复杂的解析需求，使用 <code>regex</code> crate，它有一些 rust build-in 没有的能力。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>regex</span>::<span class=n>Regex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;$ 1,500&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>let</span><span class=w> </span><span class=n>regx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Regex</span>::<span class=n>new</span><span class=p>(</span><span class=sa>r</span><span class=s>&#34;[^0-9.]&#34;</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>regx</span><span class=p>.</span><span class=n>replace_all</span><span class=p>(</span><span class=n>price</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=总结>总结</h2><p>本文探索了 Rust 中 <code>String</code> <code>str</code> 两个类型的字符串，看了看应该如何正确使用它们。我们也提供了很多示例代码来解释两个字符串类型常规的使用情况。</p><p>我希望这篇文章可以解决你的关于 Rust 字符串的困扰，帮助你写出更高效的 Rust 代码。</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 Jul 04, 2024 00:00 UTC</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 Roses</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>